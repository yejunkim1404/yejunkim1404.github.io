 import os
from openai import OpenAI
from dotenv import load_dotenv

# .env 파일에서 API 키 로드
load_dotenv()
api_key = os.getenv("OPENAI_API_KEY")

if not api_key:
    print("❌ API 키가 설정되어 있지 않습니다. .env 파일을 확인하세요.")
    exit()

client = OpenAI(api_key=api_key)

def get_user_input():
    year = input("출생년도?(숫자만): ").strip()
    count = input("이름 생성 개수?: ").strip()
    gender = input("성별이 무엇입니까? (예: 남자, 여자): ").strip()
    family_name = input("성이 무엇입니까?: ").strip()
    feeling = input("이름에서 내고 싶은 느낌은 무엇인가요? (예: 고급스러운, 귀여운, 강한 등): ").strip()

    try:
        count = int(count)
        int(year)
    except ValueError:
        print("⚠ 숫자 입력이 잘못되었습니다.")
        exit()

    if gender not in ["남자", "여자"]:
        print("⚠ 성별은 '남자' 또는 '여자'로 입력해 주세요.")
        exit()

    return year, count, gender, family_name, feeling

def generate_names(year, count, gender, family_name, feeling):
    prompt = (
        f"{year}년도에 유행하던 성 '{family_name}'에 어울리면서, '{feeling}' 느낌을 주는 "
        f"{gender} 이름 {count}개를 추천해 주세요.\n"
        "각 이름에는 번호, 한자 뜻, 그리고 실제 사람들이 사용하는 대략적인 비율이나 인기 순위도 적어 주세요.\n"
        "불필요한 설명 없이 아래 형식으로 작성해 주세요:\n"
        "1. 이름 (한자 뜻) - 사용 비율: XX%\n"
        "2. ..."
    )

    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "간결하고 형식에 맞게 이름을 추천해 주세요."},
            {"role": "user", "content": prompt}
        ]
    )

    return response.choices[0].message.content

if __name__ == "__main__":
    year, count, gender, family_name, feeling = get_user_input()
    result = generate_names(year, count, gender, family_name, feeling)
    print("\n📛 생성된 이름 및 예상 인기 비율:")
    print(result)
