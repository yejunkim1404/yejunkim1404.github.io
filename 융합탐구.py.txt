 import os
from openai import OpenAI
from dotenv import load_dotenv

# .env íŒŒì¼ì—ì„œ API í‚¤ ë¡œë“œ
load_dotenv()
api_key = os.getenv("OPENAI_API_KEY")

if not api_key:
    print("âŒ API í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")
    exit()

client = OpenAI(api_key=api_key)

def get_user_input():
    year = input("ì¶œìƒë…„ë„?(ìˆ«ìë§Œ): ").strip()
    count = input("ì´ë¦„ ìƒì„± ê°œìˆ˜?: ").strip()
    gender = input("ì„±ë³„ì´ ë¬´ì—‡ì…ë‹ˆê¹Œ? (ì˜ˆ: ë‚¨ì, ì—¬ì): ").strip()
    family_name = input("ì„±ì´ ë¬´ì—‡ì…ë‹ˆê¹Œ?: ").strip()
    feeling = input("ì´ë¦„ì—ì„œ ë‚´ê³  ì‹¶ì€ ëŠë‚Œì€ ë¬´ì—‡ì¸ê°€ìš”? (ì˜ˆ: ê³ ê¸‰ìŠ¤ëŸ¬ìš´, ê·€ì—¬ìš´, ê°•í•œ ë“±): ").strip()

    try:
        count = int(count)
        int(year)
    except ValueError:
        print("âš  ìˆ«ì ì…ë ¥ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.")
        exit()

    if gender not in ["ë‚¨ì", "ì—¬ì"]:
        print("âš  ì„±ë³„ì€ 'ë‚¨ì' ë˜ëŠ” 'ì—¬ì'ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
        exit()

    return year, count, gender, family_name, feeling

def generate_names(year, count, gender, family_name, feeling):
    prompt = (
        f"{year}ë…„ë„ì— ìœ í–‰í•˜ë˜ ì„± '{family_name}'ì— ì–´ìš¸ë¦¬ë©´ì„œ, '{feeling}' ëŠë‚Œì„ ì£¼ëŠ” "
        f"{gender} ì´ë¦„ {count}ê°œë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”.\n"
        "ê° ì´ë¦„ì—ëŠ” ë²ˆí˜¸, í•œì ëœ», ê·¸ë¦¬ê³  ì‹¤ì œ ì‚¬ëŒë“¤ì´ ì‚¬ìš©í•˜ëŠ” ëŒ€ëµì ì¸ ë¹„ìœ¨ì´ë‚˜ ì¸ê¸° ìˆœìœ„ë„ ì ì–´ ì£¼ì„¸ìš”.\n"
        "ë¶ˆí•„ìš”í•œ ì„¤ëª… ì—†ì´ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”:\n"
        "1. ì´ë¦„ (í•œì ëœ») - ì‚¬ìš© ë¹„ìœ¨: XX%\n"
        "2. ..."
    )

    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "ê°„ê²°í•˜ê³  í˜•ì‹ì— ë§ê²Œ ì´ë¦„ì„ ì¶”ì²œí•´ ì£¼ì„¸ìš”."},
            {"role": "user", "content": prompt}
        ]
    )

    return response.choices[0].message.content

if __name__ == "__main__":
    year, count, gender, family_name, feeling = get_user_input()
    result = generate_names(year, count, gender, family_name, feeling)
    print("\nğŸ“› ìƒì„±ëœ ì´ë¦„ ë° ì˜ˆìƒ ì¸ê¸° ë¹„ìœ¨:")
    print(result)
